service: stripe-webhook-sfdc
frameworkVersion: '3'

provider:
  name: aws
  region: us-east-1
  stage: ${opt:stage,'dev'}
  runtime: nodejs18.x
  iam:
    role:
      statements:
        - Effect: Allow
          Action:
            - 'secretsmanager:GetSecretValue'
          Resource:
            - 'arn:aws:secretsmanager:us-east-1:*:secret:${self:custom.stripeSecretsName}-*'

custom:
  stripeSecretsName: ${self:provider.stage}/tca-stripe-secrets

functions:
  webhookHandler:
    handler: webhook_handler.handle
    memorySize: 128
    events:
      - httpApi:
          path: /stripe_webhook
          method: post
    environment:
      STRIPE_SECRETS_NAME: ${self:custom.stripeSecretsName}
  
  sfdcHandler:
    handler: sfdc_handler.handle
    memorySize: 128
    events:
      - eventBridge:
          pattern: 
            source: 
              - stripe-webhook-lambda
            detail-type: 
              - stripe-webhook-detail-type

